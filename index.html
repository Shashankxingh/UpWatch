<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UpWatch // NEON PROTOCOL</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<script>
tailwind.config = {
  theme: {
    extend: {
      fontFamily: {
        orbitron: ['Orbitron', 'sans-serif'],
        rajdhani: ['Rajdhani', 'sans-serif'],
      },
      colors: {
        neonBlue: "#00f3ff",
        neonPink: "#ff00ff",
        neonPurple: "#bc13fe",
        darkBg: "#050510"
      },
      animation: {
        'spin-slow': 'spin 8s linear infinite',
        'float': 'float 3s ease-in-out infinite',
        'glitch': 'glitch 1s linear infinite',
      },
      keyframes: {
        float: {
          '0%, 100%': { transform: 'translateY(0)' },
          '50%': { transform: 'translateY(-10px)' },
        }
      }
    }
  }
}
</script>

<style>
  body {
    background-color: #050510;
    color: white;
    overflow-x: hidden;
    cursor: none; /* We will use custom cursor */
  }

  /* --- ANIMATED BACKGROUND --- */
  .bg-grid {
    position: fixed;
    top: 0; left: 0; width: 200%; height: 200%;
    background-image: 
      linear-gradient(rgba(0, 243, 255, 0.1) 1px, transparent 1px),
      linear-gradient(90deg, rgba(188, 19, 254, 0.1) 1px, transparent 1px);
    background-size: 50px 50px;
    transform: perspective(500px) rotateX(60deg) translateY(-100px) translateZ(-200px);
    animation: gridMove 20s linear infinite;
    z-index: -2;
    pointer-events: none;
  }

  @keyframes gridMove {
    0% { transform: perspective(500px) rotateX(60deg) translateY(0) translateZ(-200px); }
    100% { transform: perspective(500px) rotateX(60deg) translateY(50px) translateZ(-200px); }
  }

  .glow-orb {
    position: fixed;
    width: 600px; height: 600px;
    background: radial-gradient(circle, rgba(188,19,254,0.2) 0%, rgba(0,0,0,0) 70%);
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    z-index: -1;
    pointer-events: none;
  }

  /* --- RGB BORDER CARDS --- */
  .rgb-card {
    position: relative;
    background: rgba(10, 10, 25, 0.6);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    z-index: 1;
    overflow: hidden;
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
  
  .rgb-card::before {
    content: '';
    position: absolute;
    top: -50%; left: -50%;
    width: 200%; height: 200%;
    background: conic-gradient(transparent, #00f3ff, transparent 30%);
    animation: rotate 4s linear infinite;
    z-index: -2;
  }
  
  .rgb-card::after {
    content: '';
    position: absolute;
    inset: 2px;
    background: rgba(10, 10, 25, 0.9);
    border-radius: 14px;
    z-index: -1;
  }

  .rgb-card:hover {
    transform: scale(1.05) translateY(-5px);
    box-shadow: 0 0 30px rgba(0, 243, 255, 0.3);
  }

  @keyframes rotate { 100% { transform: rotate(360deg); } }

  /* --- CUSTOM CURSOR --- */
  .cursor-dot, .cursor-circle {
    position: fixed;
    top: 0; left: 0;
    transform: translate(-50%, -50%);
    pointer-events: none;
    z-index: 9999;
    border-radius: 50%;
  }
  .cursor-dot { width: 8px; height: 8px; background: white; }
  .cursor-circle { 
    width: 40px; height: 40px; 
    border: 2px solid #00f3ff;
    transition: width 0.2s, height 0.2s;
  }
  
  /* --- ANIME MASCOT --- */
  .mascot {
    position: fixed;
    width: 100px;
    height: 100px;
    background-image: url('https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExcjZ3eHoxOGk5eHR5eHpmNnZ4Z3F6eHR5eHpmNnZ4Z3F6eHR5eHpmNnZ4ZyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/13CoXDiaCcCoyk/giphy.gif'); 
    background-size: contain;
    background-repeat: no-repeat;
    pointer-events: none;
    z-index: 50;
    transition: top 0.5s ease-out, left 0.5s ease-out;
  }

</style>
</head>

<body class="font-rajdhani text-lg">

<div class="bg-grid"></div>
<div class="glow-orb"></div>
<div id="cursor-dot" class="cursor-dot"></div>
<div id="cursor-circle" class="cursor-circle"></div>

<div id="mascot" class="mascot bottom-4 right-4 animate-float"></div>

<div class="relative z-10 p-6 md:p-12 max-w-7xl mx-auto">
  
  <header class="flex flex-col md:flex-row justify-between items-center mb-12 gap-6">
    <div>
      <h1 class="font-orbitron text-5xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-neonBlue via-white to-neonPink drop-shadow-[0_0_10px_rgba(0,243,255,0.8)]">
        UPWATCH
      </h1>
      <p class="text-neonBlue tracking-[0.3em] font-bold mt-2 uppercase">System Monitor // v.9.0</p>
    </div>

    <div class="flex gap-6">
      <div class="bg-black/40 border border-neonPink/50 p-4 rounded-lg shadow-[0_0_15px_rgba(255,0,255,0.2)] backdrop-blur-md text-center">
        <div class="text-xs text-neonPink uppercase tracking-widest">Active Nodes</div>
        <div id="stat-total" class="text-3xl font-orbitron font-bold text-white">0</div>
      </div>
      <div class="bg-black/40 border border-neonBlue/50 p-4 rounded-lg shadow-[0_0_15px_rgba(0,243,255,0.2)] backdrop-blur-md text-center">
        <div class="text-xs text-neonBlue uppercase tracking-widest">Sys Integrity</div>
        <div id="stat-uptime" class="text-3xl font-orbitron font-bold text-white">0%</div>
      </div>
    </div>
  </header>

  <div class="mb-12 flex justify-end">
    <button onclick="toggleModal()" class="group relative px-8 py-3 bg-transparent border border-neonBlue text-neonBlue font-bold uppercase tracking-widest hover:bg-neonBlue hover:text-black transition-all duration-300 overflow-hidden">
      <span class="relative z-10 flex items-center gap-2">
        <i data-lucide="plus-square"></i> Initialize Node
      </span>
      <div class="absolute inset-0 bg-neonBlue transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left duration-300"></div>
    </button>
  </div>

  <div id="grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
    </div>

</div>

<div id="addModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm">
  <div class="rgb-card w-full max-w-lg p-8 transform scale-100">
    <h2 class="text-2xl font-orbitron text-white mb-6 border-b border-white/20 pb-2">
      <span class="text-neonPink">></span> NEW TARGET
    </h2>
    
    <div class="space-y-6">
      <div>
        <label class="text-neonBlue text-sm uppercase tracking-wider">Target Identifier</label>
        <input id="input-name" class="w-full bg-black/50 border border-white/20 rounded p-3 text-white focus:border-neonBlue focus:outline-none focus:shadow-[0_0_10px_#00f3ff]" placeholder="SERVER_01">
      </div>
      <div>
        <label class="text-neonBlue text-sm uppercase tracking-wider">Endpoint Vector</label>
        <input id="input-url" class="w-full bg-black/50 border border-white/20 rounded p-3 text-white focus:border-neonBlue focus:outline-none focus:shadow-[0_0_10px_#00f3ff]" placeholder="https://api.system.com">
      </div>
      <div class="flex gap-4 mt-8">
        <button onclick="toggleModal()" class="flex-1 py-3 border border-red-500 text-red-500 hover:bg-red-500 hover:text-black uppercase font-bold transition">Abort</button>
        <button id="btn-add" class="flex-1 py-3 bg-neonBlue text-black font-bold uppercase hover:bg-white hover:shadow-[0_0_20px_#00f3ff] transition">Execute</button>
      </div>
    </div>
  </div>
</div>

<script>
const API = "https://upwatch.onrender.com";
lucide.createIcons();

/* --- CURSOR LOGIC --- */
const cursorDot = document.getElementById('cursor-dot');
const cursorCircle = document.getElementById('cursor-circle');
const mascot = document.getElementById('mascot');

window.addEventListener('mousemove', (e) => {
  const x = e.clientX;
  const y = e.clientY;
  
  cursorDot.style.left = `${x}px`;
  cursorDot.style.top = `${y}px`;
  
  // Circle follows with lag
  cursorCircle.animate({
    left: `${x}px`,
    top: `${y}px`
  }, { duration: 500, fill: "forwards" });
});

// Click Interaction (Move Mascot)
window.addEventListener('click', (e) => {
  cursorCircle.style.transform = "translate(-50%, -50%) scale(0.5)";
  setTimeout(() => cursorCircle.style.transform = "translate(-50%, -50%) scale(1)", 100);

  // Move mascot near click
  mascot.style.top = `${e.clientY - 50}px`;
  mascot.style.left = `${e.clientX - 50}px`;
});

function toggleModal() {
  document.getElementById('addModal').classList.toggle('hidden');
}

/* --- LOGIC --- */
function getStatusVisuals(status) {
  const s = status.toUpperCase();
  if (s === 'UP' || s === 'OPERATIONAL') 
    return { color: 'text-neonBlue', shadow: 'shadow-[0_0_10px_#00f3ff]', icon: 'check-circle' };
  if (s === 'DOWN') 
    return { color: 'text-red-500', shadow: 'shadow-[0_0_10px_#ef4444]', icon: 'alert-octagon' };
  return { color: 'text-yellow-400', shadow: 'none', icon: 'loader' };
}

function renderCard(m) {
  const vis = getStatusVisuals(m.status);
  const latency = m.latencyHistory?.length ? m.latencyHistory.at(-1) : 0;
  
  // Fake graph bars for "Cyber" look
  const bars = Array(10).fill(0).map(() => 
    `<div class="w-1 bg-white/20 h-[${Math.random() * 100}%] rounded-sm"></div>`
  ).join('');

  return `
  <div class="rgb-card p-6 flex flex-col justify-between group">
    <div class="flex justify-between items-start">
      <div>
        <h3 class="font-orbitron text-xl text-white tracking-wide">${m.name}</h3>
        <p class="text-xs text-white/50 font-mono mt-1 break-all">${m.url}</p>
      </div>
      <i data-lucide="${vis.icon}" class="${vis.color} w-6 h-6 animate-pulse"></i>
    </div>

    <div class="my-6 h-16 flex items-end gap-1 opacity-50">
      ${m.latencyHistory ? m.latencyHistory.slice(-15).map(val => {
         const h = Math.min(val / 10, 100); 
         return `<div class="flex-1 bg-${vis.color === 'text-neonBlue' ? 'neonBlue' : 'red-500'} transition-all duration-300" style="height: ${h}%; box-shadow: 0 0 5px currentColor"></div>`
      }).join('') : ''}
    </div>

    <div class="flex items-center justify-between pt-4 border-t border-white/10">
      <div class="font-orbitron text-2xl ${vis.color} drop-shadow-[0_0_5px_currentColor]">
        ${latency} <span class="text-sm text-white/50">ms</span>
      </div>
      <div class="text-right">
        <div class="text-xs text-white/40 uppercase">Uptime</div>
        <div class="font-bold text-white">${m.uptime}%</div>
      </div>
    </div>
  </div>`;
}

async function load() {
  try {
    const res = await fetch(API + "/api/monitors");
    const rawData = await res.json();
    
    // Adapter logic
    let monitors = Array.isArray(rawData) ? rawData : rawData.monitors;
    let total = monitors.length;
    let down = monitors.filter(m => m.status === 'DOWN').length;
    
    // Calculate uptime
    const totalUptime = monitors.reduce((acc, m) => acc + parseFloat(m.uptime || 0), 0);
    const avgUptime = monitors.length ? (totalUptime / monitors.length).toFixed(2) : "0.00";

    document.getElementById('stat-total').innerText = total;
    document.getElementById('stat-uptime').innerText = avgUptime + "%";

    const grid = document.getElementById("grid");
    grid.innerHTML = monitors.map(renderCard).join("");
    lucide.createIcons();
    
  } catch (e) {
    console.log(e);
  }
}

document.getElementById('btn-add').onclick = async () => {
  const name = document.getElementById('input-name').value;
  const url = document.getElementById('input-url').value;
  if (!name || !url) return;
  
  const btn = document.getElementById('btn-add');
  btn.innerText = "EXECUTING...";
  
  await fetch(API + "/api/monitor", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name, url })
  });

  toggleModal();
  btn.innerText = "EXECUTE";
  load();
};

load();
setInterval(load, 3000);
</script>

</body>
</html>
