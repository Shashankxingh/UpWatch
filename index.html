<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UpWatch — Real Monitoring</title>

<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>

<script>
tailwind.config = {
  darkMode: "class",
  theme: {
    extend: {
      colors: {
        primary:"#0d7ff2",
        bg:"#050A14"
      },
      fontFamily:{ display:["Space Grotesk","sans-serif"] }
    }
  }
}
</script>

<style>
body { background:#050A14 }
.glass {
  background: rgba(255,255,255,.04);
  backdrop-filter: blur(24px);
  border: 1px solid rgba(255,255,255,.08);
}
</style>
</head>

<body class="font-display text-white">

<header class="glass p-6 flex justify-between items-center">
  <h1 class="text-xl font-bold">UpWatch</h1>
  <span class="text-emerald-400 text-sm">Live Monitoring</span>
</header>

<section class="p-6 max-w-xl">
  <div class="glass p-5 rounded-2xl space-y-3">
    <input id="name" placeholder="Service name"
      class="w-full bg-transparent border border-white/10 rounded-xl px-4 py-3">
    <input id="url" placeholder="https://example.com"
      class="w-full bg-transparent border border-white/10 rounded-xl px-4 py-3">
    <button id="add"
      class="w-full bg-primary text-black font-semibold py-3 rounded-xl">
      Add Monitor
    </button>
    <p id="msg" class="text-sm text-white/60"></p>
  </div>
</section>

<section id="grid" class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4"></section>

<script>
const API = "http://localhost:3000";
const grid = document.getElementById("grid");

function card(m) {
  const color =
    m.status === "UP" ? "emerald" :
    m.status === "DEGRADED" ? "yellow" :
    m.status === "DOWN" ? "red" : "gray";

  const latency = m.latencyHistory.length
    ? m.latencyHistory.at(-1) + "ms"
    : "--";

  return `
  <div class="glass p-5 rounded-2xl">
    <h3 class="font-semibold text-lg">${m.name}</h3>
    <p class="text-${color}-400 text-sm">
      ${m.status} · ${m.uptime}% uptime
    </p>
    <div class="mt-3 text-3xl font-bold">${latency}</div>
    <div class="text-xs text-white/40 mt-1">
      Last ping: ${m.lastPing ? new Date(m.lastPing).toLocaleTimeString() : "—"}
    </div>
  </div>`;
}

async function load() {
  const res = await fetch(API + "/api/monitors");
  const data = await res.json();
  grid.innerHTML = data.length
    ? data.map(card).join("")
    : "<p class='text-white/50'>No monitors yet</p>";
}

add.onclick = async () => {
  if (!name.value || !url.value.startsWith("http")) {
    msg.textContent = "Valid name & URL required";
    return;
  }

  msg.textContent = "Adding monitor...";
  await fetch(API + "/api/monitor", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ name: name.value, url: url.value })
  });
  msg.textContent = "";
  name.value = url.value = "";
  load();
};

load();
setInterval(load, 5000);
</script>

</body>
</html>